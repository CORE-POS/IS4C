<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CORE POS - IS4C: COREPOS\pos\lib\Database Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="CORE POS - IS4C"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CORE POS - IS4C
   </div>
   <div id="projectbrief">The CORE POS front end</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>COREPOS</b></li><li class="navelem"><b>pos</b></li><li class="navelem"><b>lib</b></li><li class="navelem"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html">Database</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">COREPOS\pos\lib\Database Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:af9b480e992794198f971f6b0677a6418"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#af9b480e992794198f971f6b0677a6418">tDataConnect</a> ()</td></tr>
<tr class="separator:af9b480e992794198f971f6b0677a6418"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae892962142f02a093cf88a51243b5c1b"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#ae892962142f02a093cf88a51243b5c1b">pDataConnect</a> ()</td></tr>
<tr class="separator:ae892962142f02a093cf88a51243b5c1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c11f36679cf51b62b385c0d085743b3"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a2c11f36679cf51b62b385c0d085743b3">mDataConnect</a> ()</td></tr>
<tr class="separator:a2c11f36679cf51b62b385c0d085743b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cb7bd8f220d71d16cced5ab6ef32f11"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a1cb7bd8f220d71d16cced5ab6ef32f11">mAltName</a> ()</td></tr>
<tr class="separator:a1cb7bd8f220d71d16cced5ab6ef32f11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72def4db178efb677591994052e3800e"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a72def4db178efb677591994052e3800e">getsubtotals</a> ()</td></tr>
<tr class="separator:a72def4db178efb677591994052e3800e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae204af93c9b01c65565a58565319dc60"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#ae204af93c9b01c65565a58565319dc60">LineItemTaxes</a> ()</td></tr>
<tr class="separator:ae204af93c9b01c65565a58565319dc60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a895c4ba4315741bd7b2bd570970bd7b8"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a895c4ba4315741bd7b2bd570970bd7b8">gettransno</a> ($CashierNo)</td></tr>
<tr class="separator:a895c4ba4315741bd7b2bd570970bd7b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d7c25a9a262c2d32cd093ac118b019a"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a4d7c25a9a262c2d32cd093ac118b019a">testremote</a> ()</td></tr>
<tr class="separator:a4d7c25a9a262c2d32cd093ac118b019a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebbed5e204c7d7d4e8f0770ce87ded08"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#aebbed5e204c7d7d4e8f0770ce87ded08">uploadtoServer</a> ()</td></tr>
<tr class="separator:aebbed5e204c7d7d4e8f0770ce87ded08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae92095f23069cb244ea3d43f3f7115a8"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#ae92095f23069cb244ea3d43f3f7115a8">getMatchingColumns</a> ($connection, $table_name, $table2=&quot;&quot;)</td></tr>
<tr class="separator:ae92095f23069cb244ea3d43f3f7115a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83eb0d4d99cbb2682c00348f3f742c5e"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a83eb0d4d99cbb2682c00348f3f742c5e">localMatchingColumns</a> ($connection, $table1, $table2)</td></tr>
<tr class="separator:a83eb0d4d99cbb2682c00348f3f742c5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c69b0fa0813126f9d789ee8e9b18980"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a5c69b0fa0813126f9d789ee8e9b18980">uploadCCdata</a> ()</td></tr>
<tr class="separator:a5c69b0fa0813126f9d789ee8e9b18980"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab675fae70e2cb52b40aeb3224a5fdc57"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#ab675fae70e2cb52b40aeb3224a5fdc57">loadglobalvalues</a> ()</td></tr>
<tr class="separator:ab675fae70e2cb52b40aeb3224a5fdc57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0abd0d5678835612e42801ce9cc795a"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#ad0abd0d5678835612e42801ce9cc795a">loadglobalvalue</a> ($param, $val)</td></tr>
<tr class="separator:ad0abd0d5678835612e42801ce9cc795a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa15df3628673608afcfa28cba0f0abd3"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#aa15df3628673608afcfa28cba0f0abd3">setglobalvalue</a> ($param, $value)</td></tr>
<tr class="separator:aa15df3628673608afcfa28cba0f0abd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b4249a4ccf3abf7b79387ec770b7725"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a0b4249a4ccf3abf7b79387ec770b7725">setglobalvalues</a> ($arr)</td></tr>
<tr class="separator:a0b4249a4ccf3abf7b79387ec770b7725"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54578447b065d70f85bc3a1592866c41"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a54578447b065d70f85bc3a1592866c41">setglobalflags</a> ($value)</td></tr>
<tr class="separator:a54578447b065d70f85bc3a1592866c41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeaf08f6fdc02dc92d8cd5b0cae6a4893"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#aeaf08f6fdc02dc92d8cd5b0cae6a4893">changeLttTaxCode</a> ($fromName, $toName)</td></tr>
<tr class="separator:aeaf08f6fdc02dc92d8cd5b0cae6a4893"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d16eb5ca0f496620172c8a3897177bb"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a9d16eb5ca0f496620172c8a3897177bb">rotateTempData</a> ()</td></tr>
<tr class="separator:a9d16eb5ca0f496620172c8a3897177bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b32559630f2ad9a6f0692c6424e6bf6"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a4b32559630f2ad9a6f0692c6424e6bf6">clearTempTables</a> ()</td></tr>
<tr class="separator:a4b32559630f2ad9a6f0692c6424e6bf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cc013038baf7e5075a95e14b64be003"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a0cc013038baf7e5075a95e14b64be003">logger</a> ($msg=&quot;&quot;)</td></tr>
<tr class="separator:a0cc013038baf7e5075a95e14b64be003"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions related to the database </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="aeaf08f6fdc02dc92d8cd5b0cae6a4893"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::changeLttTaxCode </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$fromName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$toName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Change one tax code in all items of localtemptrans to a different one. Parameters are the names of the taxes, as in taxrates.description </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$fromName</td><td>The name of the tax changed from. </td></tr>
    <tr><td class="paramname">$fromName</td><td>The name of the tax changed to. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a4b32559630f2ad9a6f0692c6424e6bf6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::clearTempTables </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Truncate current transaction tables. Clears data from:</p>
<ul>
<li>translog.localtemptrans</li>
<li>translog.couponApplied</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>[boolean] success or failure</dd></dl>
<p>Success or failure is based on whether translog.localtemptrans is cleared correctly. </p>

</div>
</div>
<a class="anchor" id="ae92095f23069cb244ea3d43f3f7115a8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::getMatchingColumns </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table2</em> = <code>&quot;&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get a list of columns that exist on the local db and the server db for the given table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$connection</td><td>a <a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_s_q_l_manager.html">SQLManager</a> object that's already connected </td></tr>
    <tr><td class="paramname">$table_name</td><td>the table </td></tr>
    <tr><td class="paramname">$table2</td><td>is provided, it match columns from local.table_name against remote.table2 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>[string] comma separated list of column names </dd></dl>
<p>Cache column information by table in the session In standalone mode, a transfer query likely failed and the cache may be wrong so always requery in that case.</p>

</div>
</div>
<a class="anchor" id="a72def4db178efb677591994052e3800e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::getsubtotals </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Load values from subtotals view into session. Essentially refreshes totals in the session. </p>
<p>9May14 Andy I belive this query is equivalent to the old subtotals =&gt; lttsubtotals =&gt; lttsummary I've omitted tax since those are already calculated separately. A few conditions here should obviously be more configurable, but first I want to get rid of or simply the old nested views</p>
<p>fsEligible is the complicated one. That's:</p>
<ol type="1">
<li>Total foodstampable items</li>
<li>Minus transaction-level discount on those items</li>
<li>Minus any foodstamp tenders already applied. localtemptrans.total is negative on tenders so the query uses an addition sign but in effect it's subracting. $replacementQ = " SELECT CASE WHEN MAX(trans_id) IS NULL THEN 0 ELSE MAX(trans_id) END AS LastID, MAX(card_no) AS card_no, SUM(total) AS runningTotal, SUM(CASE WHEN discounttype=1 THEN total ELSE 0 END) AS discountTTL, SUM(CASE WHEN discounttype IN (2,3) THEN total ELSE 0 END) AS staffSpecial, SUM(CASE WHEN discounttype=4 THEN total ELSE 0 END) AS discountTTL, SUM(CASE WHEN trans_type='T' THEN total ELSE 0 END) AS tenderTotal, MAX(percentDiscount) AS percentDiscount, SUM(CASE WHEN discountable=0 THEN 0 ELSE total END) as discountableTotal, SUM(CASE WHEN discountable=0 THEN 0 ELSE total END) * (MAX(percentDiscount)/100.00) AS transDiscount, SUM(CASE WHEN trans_subtype IN ('MI', 'CX') THEN total ELSE 0 END) AS chargeTotal, SUM(CASE WHEN department=990 THEN total ELSE 0 END) as paymentTotal, SUM(CASE WHEN numflag=1 THEN total ELSE 0 END) as localTotal, SUM(CASE WHEN trans_status='V' THEN total ELSE 0 END) as voidTotal, ( SUM(CASE WHEN foodstamp=1 THEN total ELSE 0 END)<ul>
<li>((MAX(percentDiscount)/100.00) SUM(CASE WHEN foodstamp=1 AND discountable=1 THEN total ELSE 0 END))</li>
<li>SUM(CASE WHEN trans_subtype IN ('EF','FS') THEN total ELSE 0 END) ) AS fsEligble FROM localtemptrans AS l WHERE trans_type &lt;&gt; 'L' ";</li>
</ul>
</li>
</ol>
<p>If FS eligible amount is greater than the current transaction total and total is positive, limit the eligible amount to the current total. This may not be technically correct but the resulting change causes a lot of headaches depending what kind of change is allowed for earlier tenders, if change is allowed for those tenders at all.</p>
<p>The other case is a refund to FS. Over-tendering on a refund doesn't make any sense.</p>

</div>
</div>
<a class="anchor" id="a895c4ba4315741bd7b2bd570970bd7b8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::gettransno </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$CashierNo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the next transaction number for a given cashier </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$CashierNo</td><td>cashier number (emp_no in tables) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>integer transaction number </dd></dl>

</div>
</div>
<a class="anchor" id="ae204af93c9b01c65565a58565319dc60"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::LineItemTaxes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Calculate taxes using new-style taxView. </p>
<dl class="section return"><dt>Returns</dt><dd>an array of records each containing:<ul>
<li>id</li>
<li>description</li>
<li>amount (taxes actually due)</li>
<li>exempt (taxes exempted because of foodstamps) There will always be one record for each existing tax rate. </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="ad0abd0d5678835612e42801ce9cc795a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::loadglobalvalue </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set new value in session. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$param</td><td>keycode </td></tr>
    <tr><td class="paramname">$val</td><td>new value </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ab675fae70e2cb52b40aeb3224a5fdc57"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::loadglobalvalues </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read globalvalues settings into session. </p>

</div>
</div>
<a class="anchor" id="a83eb0d4d99cbb2682c00348f3f742c5e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::localMatchingColumns </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$table2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get a list of columns in both tables. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$connection</td><td>a <a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_s_q_l_manager.html">SQLManager</a> object that's already connected </td></tr>
    <tr><td class="paramname">$table1</td><td>a database table </td></tr>
    <tr><td class="paramname">$table2</td><td>a database table </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>[string] comma separated list of column names </dd></dl>

</div>
</div>
<a class="anchor" id="a0cc013038baf7e5075a95e14b64be003"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::logger </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$msg</em> = <code>&quot;&quot;</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Log a message to the lane log </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$msg</td><td>A string containing the message to log. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True on success, False on failure </dd></dl>

</div>
</div>
<a class="anchor" id="a1cb7bd8f220d71d16cced5ab6ef32f11"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::mAltName </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the name of the primary server database This is only relevant in multi-store setups where the lane is shipping data to a temporary holding database to be relayed to the master HQ server later. Most operations can work off this holding database but a few may need to reference the some overarching, all-location data.</p>
<dl class="section return"><dt>Returns</dt><dd>database name w/ . separator or an empty string if no alternate is defined. </dd></dl>

</div>
</div>
<a class="anchor" id="a2c11f36679cf51b62b385c0d085743b3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::mDataConnect </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Connect to the remote server database </p>
<dl class="section return"><dt>Returns</dt><dd>a <a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_s_q_l_manager.html">SQLManager</a> object </dd></dl>

</div>
</div>
<a class="anchor" id="ae892962142f02a093cf88a51243b5c1b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::pDataConnect </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Connect to the operational database (local) </p>
<dl class="section return"><dt>Returns</dt><dd>a <a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_s_q_l_manager.html">SQLManager</a> object </dd></dl>

</div>
</div>
<a class="anchor" id="a9d16eb5ca0f496620172c8a3897177bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::rotateTempData </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Rotate current transaction data Current data in translog.localtemptrans is inserted into:</p>
<ul>
<li>translog.dtransactions</li>
<li>translog.localtrans</li>
<li>translog.localtranstoday (if not a view)</li>
<li>translog.localtrans_today (if present)</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>[boolean] success or failure</dd></dl>
<p>Success or failure is based on whether or not the insert into translog.dtransactions succeeds. That's the most important query in terms of ensuring data flows properly to the server. </p>
<p>If store_id column is present in lane dtransactions table and the lane's store_id has been configured, assign that value to the column. Otherwise it may be handled but some other mechanism such as triggers or column default values.</p>

</div>
</div>
<a class="anchor" id="a54578447b065d70f85bc3a1592866c41"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::setglobalflags </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Sets TTLFlag and FntlFlag in globalvalues table </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$value</td><td>value for both fields. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aa15df3628673608afcfa28cba0f0abd3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::setglobalvalue </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Update setting in globalvalues table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$param</td><td>keycode </td></tr>
    <tr><td class="paramname">$value</td><td>new value </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0b4249a4ccf3abf7b79387ec770b7725"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::setglobalvalues </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$arr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Update many settings in globalvalues table and in session </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$arr</td><td>An array of keys and values </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="af9b480e992794198f971f6b0677a6418"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::tDataConnect </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Connect to the transaction database (local) </p>
<dl class="section return"><dt>Returns</dt><dd>a <a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_s_q_l_manager.html">SQLManager</a> object </dd></dl>

</div>
</div>
<a class="anchor" id="a4d7c25a9a262c2d32cd093ac118b019a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::testremote </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>See if the remote database is available This function calls <a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#aebbed5e204c7d7d4e8f0770ce87ded08">uploadtoServer()</a> if the initial test works. </p>
<dl class="section return"><dt>Returns</dt><dd>integer<ul>
<li>1 server available</li>
<li>0 server down </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="a5c69b0fa0813126f9d789ee8e9b18980"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::uploadCCdata </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Transfer credit card tables to the server. See <a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#aebbed5e204c7d7d4e8f0770ce87ded08">uploadtoServer()</a>.</p>
<dl class="section return"><dt>Returns</dt><dd>boolean success / failure </dd></dl>

</div>
</div>
<a class="anchor" id="aebbed5e204c7d7d4e8f0770ce87ded08"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static COREPOS\pos\lib\Database::uploadtoServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Copy tables from the lane to the remote server The following tables are copied:</p>
<ul>
<li>dtransactions</li>
<li>suspended</li>
<li>PaycardTransactions</li>
<li>CapturedSignature</li>
</ul>
<p>On success the local tables are truncated. The <a class="el" href="class_paycards.html">Paycards</a> tables are copied in the <a class="el" href="class_c_o_r_e_p_o_s_1_1pos_1_1lib_1_1_database.html#a5c69b0fa0813126f9d789ee8e9b18980">uploadCCdata()</a> function but that gets called automatically.</p>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>1 upload succeeded</li>
<li>0 upload failed </li>
</ul>
</dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>pos/is4c-nf/lib/Database.php</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 2 2016 11:30:50 for CORE POS - IS4C by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
