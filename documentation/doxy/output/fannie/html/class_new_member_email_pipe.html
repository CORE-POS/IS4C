<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>CORE POS - Fannie: NewMemberEmailPipe Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<h1>NewMemberEmailPipe Class Reference</h1><!-- doxytag: class="NewMemberEmailPipe" --><a href="class_new_member_email_pipe-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="bfeca6d3c06208a3a3d6d41c8ccdda90"></a><!-- doxytag: member="NewMemberEmailPipe::processMail" ref="bfeca6d3c06208a3a3d6d41c8ccdda90" args="($msg)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>processMail</b> ($msg)</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5132302f48757c3bfec97b06f3c287b8"></a><!-- doxytag: member="NewMemberEmailPipe::validateHeaders" ref="5132302f48757c3bfec97b06f3c287b8" args="($headers)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>validateHeaders</b> ($headers)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_new_member_email_pipe.html#ad32fe72947ad206993d41c870e1d9b3">parseEmail</a> ($content)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_new_member_email_pipe.html#39b3367fbf1558cdbd6237e0995f17c8">rfcCompliant</a> ($str)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This is a PHP script designed to receive emails. Postfix (and perhaps other MTAs) can deliver a message to a program rathan than a mailbox. This script is meant to receive those kind of piped messages.<p>
The main idea is to provide a pathway for a host on the general internet to send a message to Fannie without allowing access to HTTP/HTTPS/MySQL. There are validation/authentication concerns no matter what the mechanism, but I think this approach has some advantages in terms of keeping responses to external inputs tailored really, really narrowly. It does add "mail server admin" to the list of hats the IT staff has to wear though.<p>
The initial usage I have in mind is signing up members via the co-op's website. When someone signs up on the site, the website would send an email to the store with their information encoded somehow (JSON, probably) and then this script could use that information to update the database. Using a mysql driver that supports prepared statements properly would be highly recommended since this increases the danger of malicious input a fair amount.<p>
For validation, I think I'll prepopuldate a set of member accounts on the POS side with some kind of random hexadecimal key on each account (likely via custdata.blueLine) and push them out to the website. The incoming member signup messages could then be required to provide the correct hex key for the account they are creating. Headers could be validated, too (From, originating server, etc) but since it's all spoofable I don't know if it's even worth bothering.<p>
Prepopulating accounts on the website does open the possibility that new memberships could become "out of stock" which is rather silly, but that should be fairly simple to avoid with a generous initial allocation and then fine-tuning based on results. It would eliminate most of the risk of accidentally giving out the same number twice if one customer is signing up in the store while another is signing up online. 
<p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="ad32fe72947ad206993d41c870e1d9b3"></a><!-- doxytag: member="NewMemberEmailPipe::parseEmail" ref="ad32fe72947ad206993d41c870e1d9b3" args="($content)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NewMemberEmailPipe::parseEmail           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>content</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Parse email message <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$content</em>&nbsp;</td><td>[string] raw email </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>keyed array<ul>
<li>header =&gt; key:value [array] of headers</li><li>body =&gt; [string] raw body</li><li>invalid =&gt; [array] of malformed lines</li></ul>
</dd></dl>
I highly doubt this is 100% RFC2822 compliant. Shouldn't matter for use cases I'm considering, but take "invalid" with a grain of salt. It just means my validation says it isn't a correctly formatted header line. 
</div>
</div><p>
<a class="anchor" name="39b3367fbf1558cdbd6237e0995f17c8"></a><!-- doxytag: member="NewMemberEmailPipe::rfcCompliant" ref="39b3367fbf1558cdbd6237e0995f17c8" args="($str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">NewMemberEmailPipe::rfcCompliant           </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>str</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check if string is an RFC2822 field name Field names should contain characters between ASCII 33 and 126 except for ":" (ASCII 58) <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$str</em>&nbsp;</td><td>[string] to check </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>[boolean] </dd></dl>

</div>
</div><p>
<hr>The documentation for this class was generated from the following file:<ul>
<li>fannie/classlib2.0/data/pipes/NewMemberEmailPipe.php</ul>
<hr size="1"><address style="align: right;"><small>Generated on 11 Sep 2014 for CORE POS - Fannie by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
