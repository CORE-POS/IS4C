<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CORE POS - Fannie: COREPOS\Fannie\API\data\pipes\NewMemberEmailPipe Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="CORE POS - Fannie"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CORE POS - Fannie
   </div>
   <div id="projectbrief">The CORE POS back end</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>COREPOS</b></li><li class="navelem"><b>Fannie</b></li><li class="navelem"><b>API</b></li><li class="navelem"><b>data</b></li><li class="navelem"><b>pipes</b></li><li class="navelem"><a class="el" href="class_c_o_r_e_p_o_s_1_1_fannie_1_1_a_p_i_1_1data_1_1pipes_1_1_new_member_email_pipe.html">NewMemberEmailPipe</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="class_c_o_r_e_p_o_s_1_1_fannie_1_1_a_p_i_1_1data_1_1pipes_1_1_new_member_email_pipe-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">COREPOS\Fannie\API\data\pipes\NewMemberEmailPipe Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for COREPOS\Fannie\API\data\pipes\NewMemberEmailPipe:</div>
<div class="dyncontent">
 <div class="center">
  <img src="class_c_o_r_e_p_o_s_1_1_fannie_1_1_a_p_i_1_1data_1_1pipes_1_1_new_member_email_pipe.png" usemap="#COREPOS\Fannie\API\data\pipes\NewMemberEmailPipe_map" alt=""/>
  <map id="COREPOS\Fannie\API\data\pipes\NewMemberEmailPipe_map" name="COREPOS\Fannie\API\data\pipes\NewMemberEmailPipe_map">
<area href="class_c_o_r_e_p_o_s_1_1_fannie_1_1_a_p_i_1_1data_1_1pipes_1_1_attachment_email_pipe.html" alt="COREPOS\Fannie\API\data\pipes\AttachmentEmailPipe" shape="rect" coords="513,56,845,80"/>
<area href="class_new_member_email_pipe.html" alt="NewMemberEmailPipe" shape="rect" coords="855,56,1187,80"/>
<area href="class_attachment_email_pipe.html" alt="AttachmentEmailPipe" shape="rect" coords="0,112,332,136"/>
<area href="class_c_o_r_e_p_o_s_1_1_fannie_1_1_plugin_1_1_cpw_invoice_import_1_1_mail_pipe.html" alt="COREPOS\Fannie\Plugin\CpwInvoiceImport\MailPipe" shape="rect" coords="342,112,674,136"/>
<area href="class_file_by_email_pipe.html" alt="FileByEmailPipe" shape="rect" coords="684,112,1016,136"/>
<area href="class_p_i_email_pipe.html" alt="PIEmailPipe" shape="rect" coords="1026,112,1358,136"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac3102fc36ffe72ece952f84227b5faff"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac3102fc36ffe72ece952f84227b5faff"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>processMail</b> ($msg)</td></tr>
<tr class="separator:ac3102fc36ffe72ece952f84227b5faff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a84e6a9551c3f3b848ff2af9efda8036e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a84e6a9551c3f3b848ff2af9efda8036e"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>validateHeaders</b> ($headers)</td></tr>
<tr class="separator:a84e6a9551c3f3b848ff2af9efda8036e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17dce11ade20b77db8ff441ac8b2cf8c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1_fannie_1_1_a_p_i_1_1data_1_1pipes_1_1_new_member_email_pipe.html#a17dce11ade20b77db8ff441ac8b2cf8c">parseEmail</a> ($content)</td></tr>
<tr class="separator:a17dce11ade20b77db8ff441ac8b2cf8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf4b85673641e9f0624a6499e968422d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_c_o_r_e_p_o_s_1_1_fannie_1_1_a_p_i_1_1data_1_1pipes_1_1_new_member_email_pipe.html#abf4b85673641e9f0624a6499e968422d">rfcCompliant</a> ($str)</td></tr>
<tr class="separator:abf4b85673641e9f0624a6499e968422d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This is a PHP script designed to receive emails. Postfix (and perhaps other MTAs) can deliver a message to a program rathan than a mailbox. This script is meant to receive those kind of piped messages.</p>
<p>The main idea is to provide a pathway for a host on the general internet to send a message to Fannie without allowing access to HTTP/HTTPS/MySQL. There are validation/authentication concerns no matter what the mechanism, but I think this approach has some advantages in terms of keeping responses to external inputs tailored really, really narrowly. It does add "mail server admin" to the list of hats the IT staff has to wear though.</p>
<p>The initial usage I have in mind is signing up members via the co-op's website. When someone signs up on the site, the website would send an email to the store with their information encoded somehow (JSON, probably) and then this script could use that information to update the database. Using a mysql driver that supports prepared statements properly would be highly recommended since this increases the danger of malicious input a fair amount.</p>
<p>For validation, I think I'll prepopuldate a set of member accounts on the POS side with some kind of random hexadecimal key on each account (likely via custdata.blueLine) and push them out to the website. The incoming member signup messages could then be required to provide the correct hex key for the account they are creating. Headers could be validated, too (From, originating server, etc) but since it's all spoofable I don't know if it's even worth bothering.</p>
<p>Prepopulating accounts on the website does open the possibility that new memberships could become "out of stock" which is rather silly, but that should be fairly simple to avoid with a generous initial allocation and then fine-tuning based on results. It would eliminate most of the risk of accidentally giving out the same number twice if one customer is signing up in the store while another is signing up online. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a17dce11ade20b77db8ff441ac8b2cf8c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">COREPOS\Fannie\API\data\pipes\NewMemberEmailPipe::parseEmail </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$content</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Parse email message </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$content</td><td>[string] raw email </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>keyed array<ul>
<li>header =&gt; key:value [array] of headers</li>
<li>body =&gt; [string] raw body</li>
<li>invalid =&gt; [array] of malformed lines</li>
</ul>
</dd></dl>
<p>I highly doubt this is 100% RFC2822 compliant. Shouldn't matter for use cases I'm considering, but take "invalid" with a grain of salt. It just means my validation says it isn't a correctly formatted header line. </p>

</div>
</div>
<a class="anchor" id="abf4b85673641e9f0624a6499e968422d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">COREPOS\Fannie\API\data\pipes\NewMemberEmailPipe::rfcCompliant </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$str</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Check if string is an RFC2822 field name Field names should contain characters between ASCII 33 and 126 except for ":" (ASCII 58) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$str</td><td>[string] to check </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>[boolean] </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>fannie/classlib2.0/data/pipes/NewMemberEmailPipe.php</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 2 2016 11:31:13 for CORE POS - Fannie by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
